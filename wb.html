<html>
    <meta charset="utf-8" />
<head>
    <style>
        .title {
            margin:10px;
            padding:10px;
        }
        .data {
            margin:10px;
            padding:10px;
            border:1px gray solid;
        }
        #go {
            width:100px;
            height:50px;
        }
        .graph {
            width:80%;
            margin:auto;
            margin-bottom:30px;
        }
    </style>

    <script>
        document.childs = [];
        let convertPointForLoadGraph = function(point) {
            return {
                x:Math.round(point.x*100/35),
                y:Math.round(100-point.y*100/450)
            };
        };
        let convertPointForEnvelopeGraph = function(point) {
            return {
                x:Math.round((point.x-45)*100/(130-45)),
                y:Math.round(100-(point.y-1500)*100/(2600-1500))
            };
        };
        let drawLineOnLoadingGraph = function(document, point) {
            let graph = document.getElementById('load');
            let line = document.createElementNS('http://www.w3.org/2000/svg','line');
            line.setAttribute('x1', '0');
            line.setAttribute('y1', '100');
            line.setAttribute('x2', ''+convertPointForLoadGraph(point).x);
            line.setAttribute('y2', ''+convertPointForLoadGraph(point).y);
            line.setAttribute('stroke', point.color);
            line.setAttribute('stroke-width', '1');
            graph.appendChild(line);
            document.childs.push(line);
        };
        let drawLineOnEnvelopeGraph = function(document, p1, p2, color) {
            let graph = document.getElementById('envelope');
            let line = document.createElementNS('http://www.w3.org/2000/svg','line');
            line.setAttribute('x1', ''+p1.x);
            line.setAttribute('y1', ''+p1.y);
            line.setAttribute('x2', ''+p2.x);
            line.setAttribute('y2', ''+p2.y);
            line.setAttribute('stroke', color);
            line.setAttribute('stroke-width', '1');
            graph.appendChild(line);
            document.childs.push(line);
        };
        let drawCircleOnLoadingGraph = function(document, load) {
            let graph = document.getElementById('load');
            let circle = document.createElementNS('http://www.w3.org/2000/svg','circle');
            let center = {
                x:load.weight*load.arm/1000,
                y:load.weight,
            }
            circle.setAttribute('cx', '' + convertPointForLoadGraph(center).x);
            circle.setAttribute('cy', '' + convertPointForLoadGraph(center).y);
            circle.setAttribute('r', '2');
            circle.setAttribute('stroke', load.color);
            circle.setAttribute('stroke-width', '0.3');
            circle.setAttribute('fill', 'lightgray');
            graph.appendChild(circle);
            document.childs.push(circle);
        };
        let drawContributionOnLoadingGraph = function(document, contribution) {
            drawLineOnLoadingGraph(document, { x:contribution.max*contribution.arm/1000, y:contribution.max, color:contribution.color });
            drawCircleOnLoadingGraph(document, contribution);
        };
        let drawLoadingGraph = function(document, data) {
            drawContributionOnLoadingGraph(document, data.frontSeat);
            drawContributionOnLoadingGraph(document, data.fuel);
            drawContributionOnLoadingGraph(document, data.backSeat);
            drawContributionOnLoadingGraph(document, data.baggage1);
            drawContributionOnLoadingGraph(document, data.baggage2);
        };

        let drawEnvelope = function(document, points, color) {
            let line = '';
            for (let i=0; i<points.length; i++) {
                line += points[i].x + ',' + points[i].y + ' ';
            }
            let graph = document.getElementById('envelope');
            let polyline = document.createElementNS('http://www.w3.org/2000/svg','polyline');
            polyline.setAttribute('points', line);
            polyline.setAttribute('style', 'fill:none;stroke:' + color + ';stroke-width:1')
            graph.appendChild(polyline);
            document.childs.push(polyline);
        }
        let drawEnvelopeGraph = function(document, data) {
            let points = [];
            points.push(convertPointForEnvelopeGraph({ x:52, y:1500 }));
            points.push(convertPointForEnvelopeGraph({ x:68, y:1950 }));
            points.push(convertPointForEnvelopeGraph({ x:83, y:2200 }));
            points.push(convertPointForEnvelopeGraph({ x:89, y:2200 }));
            points.push(convertPointForEnvelopeGraph({ x:60.5, y:1500 }));
            drawEnvelope(document, points, 'green');

            points = [];
            points.push(convertPointForEnvelopeGraph({ x:52, y:1500 }));
            points.push(convertPointForEnvelopeGraph({ x:68, y:1950 }));
            points.push(convertPointForEnvelopeGraph({ x:83, y:2200 }));
            points.push(convertPointForEnvelopeGraph({ x:104.5, y:2550 }));
            points.push(convertPointForEnvelopeGraph({ x:121, y:2550 }));
            points.push(convertPointForEnvelopeGraph({ x:70.5, y:1500 }));
            drawEnvelope(document, points, 'blue');

            let ramp = convertPointForEnvelopeGraph({ x:data.totals.moment/1000, y:data.totals.weight });
            let zerofuel = convertPointForEnvelopeGraph({ x:data.zerofuel.moment/1000, y:data.zerofuel.weight });
            drawLineOnEnvelopeGraph(document, ramp, zerofuel, 'orange');

            let graph = document.getElementById('envelope');

            let circle = document.createElementNS('http://www.w3.org/2000/svg','circle');
            circle.setAttribute('cx', '' + ramp.x);
            circle.setAttribute('cy', '' + ramp.y);
            circle.setAttribute('r', '1');
            circle.setAttribute('stroke', 'orange');
            circle.setAttribute('stroke-width', '1');
            circle.setAttribute('fill', 'lightgray');
            graph.appendChild(circle);
            document.childs.push(circle);

            let rampText = document.createElementNS('http://www.w3.org/2000/svg','text');
            rampText.setAttribute('fill', 'black');
            rampText.setAttribute('x', '' + ramp.x);
            rampText.setAttribute('y', '' + ramp.y);
            rampText.setAttribute('font-size', '3');
            rampText.innerHTML = 'ramp';
            graph.appendChild(rampText);
            document.childs.push(rampText);

            circle = document.createElementNS('http://www.w3.org/2000/svg','circle');
            circle.setAttribute('cx', '' + zerofuel.x);
            circle.setAttribute('cy', '' + zerofuel.y);
            circle.setAttribute('r', '1');
            circle.setAttribute('stroke', 'orange');
            circle.setAttribute('stroke-width', '1');
            circle.setAttribute('fill', 'lightgray');
            graph.appendChild(circle);
            document.childs.push(circle);

            let zerofuelText = document.createElementNS('http://www.w3.org/2000/svg','text');
            zerofuelText.setAttribute('fill', 'black');
            zerofuelText.setAttribute('x', '' + zerofuel.x);
            zerofuelText.setAttribute('y', '' + zerofuel.y);
            zerofuelText.setAttribute('font-size', '3');
            zerofuelText.innerHTML = 'zero fuel';
            graph.appendChild(zerofuelText);
            document.childs.push(zerofuelText);
        };
        let computeMoment = function(data, field) {
            data[field].moment = data[field].weight * data[field].arm;
        };
        let computeMoments = function(data) {
            computeMoment(data, 'frontSeat');
            computeMoment(data, 'backSeat');
            computeMoment(data, 'fuel');
            computeMoment(data, 'baggage1');
            computeMoment(data, 'baggage2');
        };
        let computeTotals = function(data) {
            data.totals.weight = data.plane.weight + data.frontSeat.weight + data.backSeat.weight + data.fuel.weight + data.baggage1.weight + data.baggage2.weight;
            data.totals.moment = data.plane.moment + data.frontSeat.moment + data.backSeat.moment + data.fuel.moment + data.baggage1.moment + data.baggage2.moment;
        };
        let computeZeroFuel = function(data) {
            data.zerofuel.weight = data.plane.weight + data.frontSeat.weight + data.backSeat.weight + data.baggage1.weight + data.baggage2.weight;
            data.zerofuel.moment = data.plane.moment + data.frontSeat.moment + data.backSeat.moment + data.baggage1.moment + data.baggage2.moment;
        };
        let drawGraph = function(document) {
            for (let i=0;i<document.childs.length;i++) {
                document.childs[i].remove();
            }
            let data = {
                frontSeat: {
                    arm: 37,
                    weight: parseInt(document.getElementById('front-seat-left').value) + parseInt(document.getElementById('front-seat-right').value),
                    max:400,
                    color:'blue'
                },
                backSeat: {
                    arm: 73,
                    weight: parseInt(document.getElementById('back-seat-left').value) + parseInt(document.getElementById('back-seat-right').value),
                    max:400,
                    color:'orange'
                },
                fuel: {
                    arm: 48,
                    weight: parseInt(document.getElementById('fuel').value),
                    max:318,
                    color:'red'
                },
                baggage1: {
                    arm: 95,
                    weight: parseInt(document.getElementById('baggage-1').value),
                    max:120,
                    color:'green'
                },
                baggage2: {
                    arm: 123,
                    weight: parseInt(document.getElementById('baggage-2').value),
                    max:50,
                    color:'purple'
                },
                plane: {
                    weight: parseInt(document.getElementById('zerofuel-weight').value),
                    moment: parseInt(document.getElementById('zerofuel-moment').value)
                },
                totals: {

                },
                zerofuel: {

                }
            };
            computeMoments(data);
            computeTotals(data);
            computeZeroFuel(data);
            drawLoadingGraph(document, data);
            drawEnvelopeGraph(document, data);
        }
    </script>
</head>
<body>
    <div class="title">
        172s
    </div>
    <div class="data">
        <input id="zerofuel-weight" value="1649.90" />lbs
        <input id="zerofuel-moment" value="66232.4" />lbs-in
        <br/>
        <br/>
        <input id="front-seat-left" value="170" />lbs
        <input id="front-seat-right" value="105" />lbs
        <br/>
        <input id="back-seat-left" value="0" />lbs
        <input id="back-seat-right" value="0" />lbs
        <br/>
        <input id="gallons" value="40" />gallons x 6 lbs/gal =
        <input id="fuel" value="240" />lbs
        <br/>
        <input id="baggage-1" value="0" />lbs baggage #1
        <br/>
        <input id="baggage-2" value="0" />lbs baggage #2
        <br/>
        <button id="go" onclick="drawGraph(document)">Refresh</button>
    </div>
    <div class="graph">
        <svg id="envelope" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
        	<rect x="0" y="0" width="100" height="100" stroke="WhiteSmoke" fill="lightgray" stroke-width="0"/>
        </svg>
    </div>
    <div class="graph">
        <svg id="load" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
        	<rect x="0" y="0" width="100" height="100" stroke="WhiteSmoke" fill="lightgray" stroke-width="0"/>
        </svg>
    </div>

    <script>setTimeout(function(){ drawGraph(document); }, 100);</script>
</body>
</html>
