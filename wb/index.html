<html>
<meta charset="utf-8" />

<head>
    <title>Yop, fly!</title>
    <link rel="stylesheet" href="assets/main.css">
    <link rel="stylesheet" href="assets/types/172s.css">
    <script src="assets/types/all-types.js"></script>
    <script src="assets/types/172s.js"></script>
    <script src="assets/planes.js"></script>
    <script src="assets/model.js"></script>
    <script src="assets/svg.js"></script>
    <script src="assets/digest.js"></script>
    <script src="assets/change.inputs.js"></script>
    <script src="assets/encoding.js"></script>
    <script src="assets/draw.js"></script>
</head>

<body>
    <div class="data">
        <select name="planes" id="planes" onchange="selectPlane(document, this.options[this.selectedIndex].id); updateFlight(document);"></select>
        <br/>
        <input id="zerofuel-weight" oninput="updatePlaneArm(document); updateFlight(document);"/>lbs
        <input id="zerofuel-moment" oninput="updatePlaneArm(document);" class="large"/>lbs-in
        <br/>
        <label id="zerofuel-arm"></label>
        <br/>
        <label>Stations:</label>            
        <div id="stations">
            <input id="frontseat-1" value="180" oninput="document.plane.type.onUpdate(this, document);" />lbs
            <input id="frontseat-2" value="110" oninput="document.plane.type.onUpdate(this, document);" />lbs
            <br/>
            <input id="backseat-1" value="0" oninput="document.plane.type.onUpdate(this, document);" />lbs
            <input id="backseat-2" value="0" oninput="document.plane.type.onUpdate(this, document);" />lbs
            <br/>
            <input id="gallons" value="40" class="small" oninput="document.plane.type.onUpdate(this, document);" />gallons x 6 lbs/gal =
            <input id="tank" value="240" class="small" oninput="document.plane.type.onUpdate(this, document);" />lbs
            <br/>
            <input id="baggage1" value="0" oninput="document.plane.type.onUpdate(this, document);" />lbs baggage #1
            <br/>
            <input id="baggage2" value="0" oninput="document.plane.type.onUpdate(this, document);" />lbs baggage #2
        </div>

        <label id="total-weight"></label>
        <br/>
        <label>Link to flight: </label><a id="flight-link" href=""></a>
        
    </div>
    <div class="graph">
        <svg id="load" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 80">
        	<rect x="0" y="0" width="100" height="80"/>
        </svg>
    </div>
    <div class="graph">
        <svg id="envelope" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 80">
        	<rect x="0" y="0" width="100" height="80"/>
        </svg>
    </div>
    <div class="graph">
        <svg id="cg" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 80">
        	<rect x="0" y="0" width="100" height="80"/>
        </svg>
    </div>

    <script>
        updateFlightLink = function(document) {
            var flight = {
                plane: document.plane.name,
                'frontseat-1': document.getElementById('frontseat-1').value,
                'frontseat-2': document.getElementById('frontseat-2').value,
                'backseat-1': document.getElementById('backseat-1').value,
                'backseat-2': document.getElementById('backseat-2').value,
                'gallons': document.getElementById('gallons').value,
                'tank': document.getElementById('tank').value,
                'baggage1': document.getElementById('baggage1').value,
                'baggage2': document.getElementById('baggage2').value,
            }
            var encoded = encodeFlight(flight, window);
            var url = window.location.pathname + '?flight=' + encoded;
            var link = document.getElementById('flight-link');
            link.href = url;
            link.innerHTML = encoded.substring(0, 5) + '...';
        };

        setTimeout(function() {
            loadTypes(document, types);
            loadPlanes(document, planes);
            selectPlane(document, planes[0].name);

            var flight = decodeFlight(window.location.search, window);
            if (flight !== undefined) {
                var planeIndex = selectPlaneIndex(document, flight.plane);
                if (planeIndex !== undefined) {
                    var select = document.getElementById('planes');
                    select.selectedIndex = planeIndex;
                    selectPlane(document, flight.plane);  
                    
                    document.getElementById('frontseat-1').value = flight['frontseat-1']
                    document.getElementById('frontseat-2').value = flight['frontseat-2']
                    document.getElementById('backseat-1').value = flight['backseat-1']
                    document.getElementById('backseat-2').value = flight['backseat-2']
                    document.getElementById('gallons').value = flight['gallons']
                    document.getElementById('tank').value = flight['tank']
                    document.getElementById('baggage1').value = flight['baggage1']
                    document.getElementById('baggage2').value = flight['baggage2']
                }
            }
            updateFlight(document);
        }, 100);
    </script>
</body>

</html>
